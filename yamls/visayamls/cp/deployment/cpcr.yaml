apiVersion: prophecy.simpledatalabs.inc/v1
kind: ProphecyCluster
metadata:
  name: prophecy
spec:
  # Add fields here
  prophecyclustername: prophecy
  prophecyclusterid: "0XC0000001"
  namespace: prophecy
  disable_fluentbit_sidecar: true
  path-prefix: "/storage"
  prophecy_file_server: http://pkg-manager:8800
  prophecy_jar_name: prophecy-libs-assembly-1.0.jar
  prophecy_libs_jar_name: prophecy-libs_2.11-1.0.jar
  tenant_name: prophecy
  customer_name: visa
  enabledapps: app,cgweb,gitserver,lineage,metagraph,postgres,sparkedge,utweb,pkgmanager,metadataui
  auth-backend: ldap
  openid-connector-id: ldapvisa
  openid-federator-host: openidfederator-service
  bootup:
    image: runtime/busybox:1.32.0
    bootup-volume:
      volumename: nfs-init-common-pv
    nodeselector:
      pharos.io/pke-nodepool: default
    securitycontext:
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
    tolerations:
      - effect: NoSchedule
        key: pharos.io/pke-nodepool
        operator: Equal
        value: default
    resources:
      limits:
        cpu: "1"
        memory: 1Gi
      requests:
        cpu: "1"
        memory: 1Gi

  app:
    image: prophecy/app:latest
    securitycontext:
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
    nodeselector:
      pharos.io/pke-nodepool: default
    tolerations:
      - effect: NoSchedule
        key: pharos.io/pke-nodepool
        operator: Equal
        value: default
    resources:
      limits:
        cpu: "2"
        memory: 4Gi
      requests:
        cpu: "2"
        memory: 4Gi
    loggingurl: ""
    monitoringurl: ""
    openid-client-id: visaprophecyapp
    openid-federator-port: "5556"
    openid-issuer-url: https://federator.stage.visa.com
    openid-redirect-ui: http://0.0.0.0:5555/callback
    gitserver-iframe-enabled: false
    gitserver-url: gitserver.stage.visa.com 
    resources:
      limits:
        cpu: "2"
        memory: 4Gi
      requests:
        cpu: "2"
        memory: 4Gi
  metadataui:
    image: prophecy/metadataui:latest
    nodeselector:
      pharos.io/pke-nodepool: default
    securitycontext:
      runAsUser: 101
      runAsGroup: 1001
      fsGroup: 1001
    tolerations:
      - effect: NoSchedule
        key: pharos.io/pke-nodepool
        operator: Equal
        value: default
    resources:
      limits:
        cpu: "1"
        memory: 1Gi
      requests:
        cpu: "1"
        memory: 1Gi

  postgres:
    image: prophecy/postgres-sdl:latest
    securitycontext:
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
    nodeselector:
      pharos.io/pke-nodepool: default
    tolerations:
      - effect: NoSchedule
        key: pharos.io/pke-nodepool
        operator: Equal
        value: default
    resources:
      limits:
        cpu: "2"
        memory: 4Gi
      requests:
        cpu: "2"
        memory: 4Gi
    postgres-log-volume:
      volumename: postgres-log-volume-prophecy
    postgres-volume:
      accessmode: ReadWriteOnce
      storageclassname: localpath
      storagetype: local
      volumename: postgres-hp-volume-prophecy
  metagraph:
    image: prophecy/metadatagraph:latest    
    securitycontext:
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
    nodeselector:
      pharos.io/pke-nodepool: default
    tolerations:
      - effect: NoSchedule
        key: pharos.io/pke-nodepool
        operator: Equal
        value: default
    resources:
      limits:
        cpu: "3"
        memory: 8Gi
      requests:
        cpu: "3"
        memory: 8Gi
    enable-git-manager: false
    gitmanagerimage: prophecy/alpine/git:latest
    metagraph-projectrepos-volume:
      accessmode: ReadWriteOnce
      storageclassname: localpath
      storagetype: local
      volumename: metagraph-projectrepos-hp-volume-prophecy
  gitserver:
    image: prophecy/gitserver:latest
    securitycontext:
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
    nodeselector:
      pharos.io/pke-nodepool: default
    tolerations:
      - effect: NoSchedule
        key: pharos.io/pke-nodepool
        operator: Equal
        value: default
    resources:
      limits:
        cpu: "2"
        memory: 4Gi
      requests:
        cpu: "2"
        memory: 4Gi
    git-log-volume:
      volumename: gitserver-log-volume-prophecy
    git-volume:
      accessmode: ReadWriteOnce
      storageclassname: localpath
      storagetype: local
      volumename: gitserver-hp-volume-prophecy
  cgweb:
    image: prophecy/codegenweb:latest
    securitycontext:
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
    nodeselector:
      pharos.io/pke-nodepool: default
    tolerations:
      - effect: NoSchedule
        key: pharos.io/pke-nodepool
        operator: Equal
        value: default
    resources:
      limits:
        cpu: "3"
        memory: 8Gi
      requests:
        cpu: "3"
        memory: 8Gi
  sparkedge:
    image: prophecy/sparkedge:latest
    securitycontext:
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
    nodeselector:
      pharos.io/pke-nodepool: default
    tolerations:
      - effect: NoSchedule
        key: pharos.io/pke-nodepool
        operator: Equal
        value: default
    resources:
      limits:
        cpu: "1"
        memory: 2Gi
      requests:
        cpu: "1"
        memory: 2Gi
  lineage:
    image: prophecy/lineageweb:latest
    securitycontext:
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
    nodeselector:
      pharos.io/pke-nodepool: default
    tolerations:
      - effect: NoSchedule
        key: pharos.io/pke-nodepool
        operator: Equal
        value: default
    resources:
      limits:
        cpu: "1"
        memory: 2Gi
      requests:
        cpu: "1"
        memory: 2Gi
  utweb:
    image: prophecy/utweb:latest
    securitycontext:
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
    nodeselector:
      pharos.io/pke-nodepool: default
    tolerations:
      - effect: NoSchedule
        key: pharos.io/pke-nodepool
        operator: Equal
        value: default
    resources:
      limits:
        cpu: "1"
        memory: 2Gi
      requests:
        cpu: "1"
        memory: 2Gi
  pkg_manager:
    image: prophecy/pkg-manager:latest
    securitycontext:
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
    nodeselector:
      pharos.io/pke-nodepool: default
    tolerations:
      - effect: NoSchedule
        key: pharos.io/pke-nodepool
        operator: Equal
        value: default
    resources:
      limits:
        cpu: "1"
        memory: 1Gi
      requests:
        cpu: "1"
        memory: 1Gi
  size: 3
  name: prophecy
  externalstorage:
    storagetype: nfs
    storageclassname: nfs
    base-vol-name: cp-shared-vol
  initcontainer:
    busyboximage: runtime/busybox:1.32.0
